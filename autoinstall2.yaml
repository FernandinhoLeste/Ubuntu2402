---
autoinstall:
  version: 1
  packages:
    - ubuntu-desktop
  snaps:
    - name: firefox
    - name: gnome-3-38-2004
    - name: gtk-common-themes
    - name: snap-store
    - name: snapd-desktop-integration
  identity:
    realname: ubuntu
    username: ubuntu
    password: $6$exDY1mhS4KUYCE/2$zmn9ToZwTKLhCw.b4/b.ZRTIZM30JZ4QrOQ2aOXJ8yk96xpcCof0kxKwuX1kqLG/ygbJ1f8wxED22bTL4F46P0
    hostname: ubuntu-desktop
storage:
  layout:
    name: direct
  config:
    - id: disk0
      type: disk
      wipe: superblock
      ptable: gpt
      path: /dev/sda
      grub_device: true
      preserve: false
    - id: disk0p1
      type: partition
      size: 536870912
      device: disk0
      flag: boot
    - id: disk0p2
      type: partition
      device: disk0
      size: 241G
      number: 2
  filesystems:
    - id: bpool
      type: zfs
      volume: bpool
      pool: bpool
      mount:
        path: /boot
    - id: rpool
      type: zfs
      volume: rpool
      pool: rpool
      mount:
        path: /
      encryption: $6$exDY1mhS4KUYCE/2$zmn9ToZwTKLhCw.b4/b.ZRTIZM30JZ4QrOQ2aOXJ8yk96xpcCof0kxKwuX1kqLG/ygbJ1f8wxED22bTL4F46P0
      cipher: aes-256-gcm
      pbkdf: argon2id
      pbkdf-config:
        key-rotation-interval: 0s
      source:
        devices:
          - disk0p2
    - id: swap
      type: zfs
      volume: swap
      pool: rpool
      mount:
        path: none
        swap: true
        size: 4G
  pools:
    - name: bpool
      config:
        - source: disk0p1
          partition: true
    - name: rpool
      config:
        - source: disk0p2
          encryption: $6$exDY1mhS4KUYCE/2$zmn9ToZwTKLhCw.b4/b.ZRTIZM30JZ4QrOQ2aOXJ8yk96xpcCof0kxKwuX1kqLG/ygbJ1f8wxED22bTL4F46P0
  early-commands:
    - echo 'linux-generic-hwe-22.04' > /run/kernel-meta-package
  late-commands:
    - curtin in-target -- sed -i /etc/default/grub -e
      's/GRUB_CMDLINE_LINUX_DEFAULT=".*/GRUB_CMDLINE_LINUX_DEFAULT="quiet
      splash"/'
    - curtin in-target -- update-grub
    - rm /target/etc/netplan/00-installer-config*yaml
    - 'printf "network:\n  version: 2\n  renderer: NetworkManager" >
      /target/etc/netplan/01-network-manager-all.yaml'
    - curtin in-target -- apt-get remove -y btrfs-progs cryptsetup* lvm2 xfsprogs
    - curtin in-target -- apt-get remove -y ubuntu-server ubuntu-server-minimal
      binutils byobu curl dmeventd finalrd gawk kpartx mdadm ncurses-term
      needrestart open-iscsi openssh-server sg3-utils ssh-import-id sssd
      thin-provisioning-tools vim tmux sosreport screen open-vm-tools
      motd-news-config lxd-agent-loader landscape-common htop git
      fonts-ubuntu-console ethtool
    - curtin in-target -- apt-get install -y cloud-init
    - curtin in-target -- apt-get autoremove -y
